<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>API reference - dipole</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="..">dipole</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../introduction/">Introduction</a>
                    </li>
                
                
                
                    <li >
                        <a href="../examples/">Examples</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">API reference</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/zheksoon/dipole/edit/master/docs/api.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#api-reference">API reference</a></li>
            <li class="second-level"><a href="#observable">Observable</a></li>
                
                <li class="third-level"><a href="#constructor">constructor</a></li>
                <li class="third-level"><a href="#get">.get()</a></li>
                <li class="third-level"><a href="#setvalue">.set(value)</a></li>
                <li class="third-level"><a href="#notify">.notify()</a></li>
            <li class="second-level"><a href="#computed">Computed</a></li>
                
                <li class="third-level"><a href="#constructor_1">constructor</a></li>
                <li class="third-level"><a href="#get_1">.get()</a></li>
            <li class="second-level"><a href="#reaction">Reaction</a></li>
                
                <li class="third-level"><a href="#constructor_2">constructor</a></li>
                <li class="third-level"><a href="#runargs">.run(...args)</a></li>
                <li class="third-level"><a href="#destroy">.destroy()</a></li>
                <li class="third-level"><a href="#commitsubscriptions">.commitSubscriptions()</a></li>
                <li class="third-level"><a href="#setoptionsoptions">.setOptions(options)</a></li>
            <li class="second-level"><a href="#actions-and-transactions">Actions and transactions</a></li>
                
                <li class="third-level"><a href="#action">action</a></li>
                <li class="third-level"><a href="#transaction-tx">transaction (tx)</a></li>
                <li class="third-level"><a href="#untracked-transaction-utx">untracked transaction (utx)</a></li>
            <li class="second-level"><a href="#utilities">Utilities</a></li>
                
                <li class="third-level"><a href="#makeobservableobject">makeObservable(object)</a></li>
                <li class="third-level"><a href="#fromgetterthunk">fromGetter(thunk)</a></li>
                <li class="third-level"><a href="#notifythunk">notify(thunk)</a></li>
            <li class="second-level"><a href="#configure">configure</a></li>
                
                <li class="third-level"><a href="#reactionscheduler">reactionScheduler</a></li>
                <li class="third-level"><a href="#subscriberscheckinterval">subscribersCheckInterval</a></li>
                <li class="third-level"><a href="#maxreactioniterations">maxReactionIterations</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="api-reference">API reference</h1>
<h2 id="observable">Observable</h2>
<h3 id="constructor">constructor</h3>
<pre><code class="language-ts">interface IObservableOptions&lt;T&gt; {
    checkValue?: (prevValue: T, nextValue: T) =&gt; boolean;
}

new Observable&lt;T&gt;(value: T, options?: IObservableOptions&lt;T&gt;): Observable&lt;T&gt;
observable&lt;T&gt;(value: T, options?: IObservableOptions&lt;T&gt;): Observable&lt;T&gt;
</code></pre>
<p>Creates an <code>Observable</code> instance containing the <code>value</code>. </p>
<p><code>options</code> object may optionally contain <code>checkValue</code> function, which will be invoked on every <code>set()</code> call and compare current and new observable values. If the <code>checkValue</code> returns <code>true</code> (means the values are equal), change signal is not propogated to its subscribers.</p>
<h3 id="get">.get()</h3>
<pre><code class="language-ts">Observable.prototype.get()
</code></pre>
<p>Get the value from <code>Observable</code> instance and track the usage of the observable into currently executed <code>Computed</code> or <code>Reaction</code></p>
<h3 id="setvalue">.set(value)</h3>
<pre><code class="language-ts">Observable.prototype.set(value)
</code></pre>
<p>Sets a new value of <code>Observable</code>, notifying dependent <code>Computed</code>/<code>Reaction</code> about the change. If the observable instance was created with <code>checkValue</code> function, performs the check first and does the subscribers notification only if <code>checkValue</code> returned <code>false</code>.</p>
<h3 id="notify">.notify()</h3>
<pre><code class="language-ts">Observable.prototype.notify()
</code></pre>
<p>Notify dependent <code>Computed</code>/<code>Reaction</code> about a change in underlying <code>Observable</code>'s value. Useful after changing mutable objects like Arrays, Maps or any other objects. <code>checkValue</code> option doesn't change the behaviour.</p>
<h2 id="computed">Computed</h2>
<h3 id="constructor_1">constructor</h3>
<pre><code class="language-ts">interface IComputedOptions&lt;T&gt; {
    checkValue?: (prevValue: T, nextValue: T) =&gt; boolean;
    keepAlive?: boolean;
}

new Computed&lt;T&gt;(computer: () =&gt; T, options?: IComputedOptions&lt;T&gt;)
computed&lt;T&gt;(computer: () =&gt; T, options?: IComputedOptions&lt;T&gt;)
</code></pre>
<p>Create a <code>Computed</code> instance with <code>computer</code> function used for computed value calculations. <code>computer</code> must be a pure function and not change/notify any observable - only <code>.get()</code> calls to other <code>Observable</code>/<code>Computed</code> values are prohibited. </p>
<p><code>options</code> object may optionally contain <code>checkValue</code> function, which enables complex logic that stops dependant reactions or computed values from running if the value of the computed hasn't changed.</p>
<p><code>keepAlive</code> option prevents the computed value from being destroyed when is looses all subscribers or after being accessed outside of reactive context.</p>
<h3 id="get_1">.get()</h3>
<pre><code class="language-ts">Computed.prototype.get()
</code></pre>
<p>Get result of <code>computer</code> function invocation. The result is computed at the moment of invocation, if it's the first time the method is called or some of computed dependencies are changed. Otherwise, cached value is returned. Also it tracks the usage of the computed into underlying <code>Computed</code> or <code>Reaction</code></p>
<h2 id="reaction">Reaction</h2>
<h3 id="constructor_2">constructor</h3>
<pre><code class="language-ts">new Reaction(reactor [, context [, manager, [, options]]])
reaction(reactor [, context [, manager, [, options]]])
</code></pre>
<p>Creates a <code>Reaction</code> instance with <code>reactor</code> function in its core, with optional <code>context</code> and <code>manager</code> arguments. <code>context</code> is <code>this</code> argument for <code>reactor</code> param, defaults to <code>undefined</code>. <code>manager</code> is a function that should somehow schedule/manage invocation of <code>.run()</code> method of the object on reaction's dependency change. See <a href="https://github.com/zheksoon/dipole-react">dipole-react</a> bindings for example of <code>manager</code> usage. </p>
<p>The <code>options</code> argument has following definition: </p>
<pre><code class="language-ts">interface IReactionOptions {
    autocommitSubscriptions?: boolean;
}
</code></pre>
<p>Options description:</p>
<ul>
<li>
<p><code>autocommitSubscriptions?: boolean</code> (default value - <code>true</code>): when <code>false</code>, forces <code>Reaction</code> instance not to subscribe to observable and computed values automatically, only after manually calling <a href="#commitSubscriptions">commitSubscriptions</a> method. </p>
<p>This option was added to support SSR, Concurrent and Strict Modes in <code>dipole-react</code> connector, when rendered component can be thrown away. Without the option it would introduce a memory leak. Please see <a href="https://github.com/zheksoon/dipole-react">dipole-react</a> source code for more details.</p>
</li>
</ul>
<h3 id="runargs">.run(...args)</h3>
<p>Runs reaction's <code>reactor</code> function with <code>this</code> set to <code>context</code> and passes all method's arguments to it. Reaction body runs in implicit transaction, so there is no need to use transactions inside of it.</p>
<h3 id="destroy">.destroy()</h3>
<p>Destroys reaction, so it doesn't react to any changes anymore before next manual invocation of <code>.run()</code> method.</p>
<h3 id="commitsubscriptions">.commitSubscriptions()</h3>
<p>The method has effect only in case <code>autocommitSubscriptions</code> option was set to <code>false</code>. 
It make the reaction instance subscribe to all its dependencies that were collected during the last <code>.run()</code> call.</p>
<h3 id="setoptionsoptions">.setOptions(options)</h3>
<p>The method allows to set reaction options on the fly. Currently only <code>autocommitSubscriptions</code> is supported. It's better not to call the method inside of <code>.run()</code>,  so reaction's subscriptions will be consistent.</p>
<h2 id="actions-and-transactions">Actions and transactions</h2>
<h3 id="action">action</h3>
<pre><code class="language-ts">action((...args) =&gt; { ...action body... })
</code></pre>
<p>Returns a function wrapped in untracked transaction. Calls to the resulting function will pass all arguments and  <code>this</code> to action body.  Since action body is untracked, <code>.get()</code> calls or getters to any observables/computed values won't introduce new dependencies when called inside action body (but it's not true for transaction).</p>
<h3 id="transaction-tx">transaction (tx)</h3>
<pre><code class="language-ts">tx(() =&gt; { ...transaction body... })
</code></pre>
<p>Execute transaction body function in transaction block. The body function is invoked without any arguments or <code>this</code>. </p>
<h3 id="untracked-transaction-utx">untracked transaction (utx)</h3>
<pre><code class="language-ts">utx(() =&gt; { ...transaction body with result... })
</code></pre>
<p>Execute transaction body in untracked transaction and return execution result. Because transaction is untracked, <code>.get()</code> calls or getters to any observables/computed values won't introduce new dependencies when called inside of it.</p>
<h2 id="utilities">Utilities</h2>
<h3 id="makeobservableobject">makeObservable(object)</h3>
<pre><code class="language-ts">makeObservable(object)
</code></pre>
<p>Iterates through own enumerable properties and replaces them with getters/setters for each instanse of Observable/Computed classes. Only properties are processed, so if there are already some getters on the object, they won't be invoked. Mutates the object and returns it as result.</p>
<h3 id="fromgetterthunk">fromGetter(thunk)</h3>
<pre><code class="language-ts">fromGetter(() =&gt; { ...some getter call to observable/computed... })
</code></pre>
<p>Returns an observable/computed object hidden under some getter called in the body function. Returns <code>undefined</code> if the function didn't call any getters/<code>.get()</code> methods. If there is more than one getter call in the body function, only result for the latest one returned.</p>
<h3 id="notifythunk">notify(thunk)</h3>
<pre><code class="language-ts">notify(() =&gt; { ...some getter calls on observables... })
</code></pre>
<p>Calls <code>.notify()</code> method on all observables, which getters were executed in body function.</p>
<h2 id="configure">configure</h2>
<p>dipole has global <code>configure</code> function that allows to tune some internal behaviour.</p>
<pre><code class="language-ts">interface GlobalConfig {
    reactionScheduler: (runner: () =&gt; void) =&gt; void;
    subscribersCheckInterval: number;
    maxReactionIterations: number;
}

export function configure(config: GlobalConfig): void;
</code></pre>
<h3 id="reactionscheduler">reactionScheduler</h3>
<p><code>reactionScheduler</code> option allows to customize the way how reaction queue will be runned. The option must be a function that takes one argument (<code>runner</code>), and, when called, should somehow run the <code>runner</code> function.</p>
<p>Default implementation is equivalent to the following:</p>
<pre><code class="language-ts">configure({
    reactionScheduler: (runner) =&gt; runner(),
})
</code></pre>
<p>e.g. runs the <code>runner</code> immediately.</p>
<p>For some practical use cases (especially when asyncronous operations are used) microtask runner could be useful:</p>
<pre><code class="language-ts">configure({
    reactionScheduler: (runner) =&gt; Promise.resolve().then(runner),
})
</code></pre>
<p>This will allow to skip wrapping observable state changes inside async flow in <code>utx</code> functions, allowing cleaner code like this:</p>
<pre><code class="language-ts">class UserModel {
    fetchUsers = action(async () =&gt; {
        this.isLoading = true;
        try {
            this.users = await fetch(...).then((res) =&gt; res.json());
        } catch (err) {
            this.error = err;
        } finally {
            this.isLoading = false;
        }
    }) 
}
</code></pre>
<h4 id="global-error-handling">Global error handling</h4>
<p>When some reaction raises an error, reaction execution loop is stopped. In order to continue, you should run the <code>runner</code> function again until it exits normally:</p>
<pre><code class="language-ts">function reactionScheduler(runner: () =&gt; void) {
    while (true) {
        try {
            runner();
            break;
        } catch (err) {
            // Global error handler
            console.log(err);
        }
    }
}

configure({ reactionScheduler });
</code></pre>
<h3 id="subscriberscheckinterval">subscribersCheckInterval</h3>
<p><code>subscribersCheckInterval</code> option is interval in milliseconds for how often computed values that lost all their subscriptions (or never gained them) will be invalidated. Default value is <code>1000</code>.</p>
<h3 id="maxreactioniterations">maxReactionIterations</h3>
<p><code>maxReactionIterations</code> limits number of reaction schedule/exceution loops, preventing dipole from infinite loops in case when a reaction changes some of its dependencies. Must be greater than <code>0</code>. Default value is <code>100</code>. When the limit is exceeded, a corresponding message will be logged to console.</p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
